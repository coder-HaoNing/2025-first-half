## **学生作业信息录入模块接口文档（最终版）**

## 1. 学生信息查询

### **1.1 根据姓名和性别查询学生列表（支持分页、排序）**

#### **基本信息**

- **请求路径**: `/students`
- **请求方式**: GET
- **接口描述**: 查询学生列表，支持按姓名模糊搜索、性别精确筛选，结果按作业次序升序排序

#### **请求参数**

| 参数名     | 类型   | 是否必须 | 示例 | 备注                    |
| :--------- | :----- | :------- | :--- | :---------------------- |
| `name`     | string | 否       | 张三 | 按学生姓名模糊查询      |
| `gender`   | string | 否       | 男   | 按性别精确查询（男/女） |
| `page`     | number | 否       | 1    | 分页页码，默认为1       |
| `pageSize` | number | 否       | 10   | 每页记录数，默认为10    |

#### **响应数据**

```json
{
    "code": 1,
    "msg": "success",
    "data": {
        "total": 100,
        "rows": [
            {
                "student_id": "S001",
                "student_name": "张三",
                "gender": "男",
                "homeworks": [
                    {
                        "homework_order": 1,
                        "homework_image": "/images/S001_1.png",
                        "score": 90.5,          // AI自动生成的评分
                        "comment": "作业完成优秀" // AI自动生成的评语
                    }
                ]
            }
        ]
    }
}
```

**排序逻辑**：按学生最新作业的 `homework_order` 升序排列（若学生无作业，则排最后）。

------

## **2. 新增学生作业信息（整合学生信息和作业信息）**

### **2.1 新增学生作业信息（自动创建学生记录）**

#### **基本信息**

- **请求路径**: `/students/assignments`
- **请求方式**: POST
- **接口描述**: 提交学生信息和作业信息，若学生不存在则自动创建，并调用AI生成评分和评语

#### **请求参数（表单格式）**

| 参数名           | 类型   | 是否必须 | 示例      | 备注                         |
| :--------------- | :----- | :------- | :-------- | :--------------------------- |
| `student_id`     | string | 是       | S001      | 学号（唯一标识）             |
| `student_name`   | string | 是       | 张三      | 学生姓名                     |
| `gender`         | string | 是       | 男        | 性别（男/女）                |
| `homework_order` | string | 是       | 第1次作业 | 格式为“第N次作业”（N为数字） |
| `homework_image` | file   | 是       | -         | 作业图片文件（支持 PNG/JPG） |

#### **响应数据**

```json
{
    "code": 1,
    "msg": "学生作业信息添加成功",
    "data": {
        "student_info": {
            "student_id": "S001",
            "student_name": "张三",
            "gender": "男"
        },
        "homework_info": {
            "homework_order": 1,
            "homework_image_path": "/images/S001_1.png",
            "score": 90.5,          // AI自动生成的评分
            "comment": "作业完成优秀" // AI自动生成的评语
        }
    }
}
```

**处理逻辑**：

1. **校验学号唯一性**：
   - 若学号已存在，直接添加作业记录（需校验作业次序唯一性）。
   - 若学号不存在，自动创建学生记录。
2. **校验字段格式**：
   - `homework_order` 必须匹配“第N次作业”格式（提取数字N为 `homework_order` 字段值）。
   - 图片文件类型限制为 PNG/JPG。
3. **调用AI服务**：
   - 图片上传后，调用AI生成评分和评语，存入作业表。

**错误响应示例**：

```json
{
    "code": 0,
    "msg": "学号已存在且作业次序重复",
    "data": null
}
```

------

## **3. 删除学生信息**

### **3.1 删除学生及其所有作业记录**

#### **基本信息**

- **请求路径**: `/students/{student_id}`
- **请求方式**: DELETE
- **接口描述**: 删除学生信息及其关联的所有作业记录

#### **响应数据**

```json
{
    "code": 1,
    "msg": "学生信息删除成功",
    "data": null
}
```

**级联逻辑**：删除学生时，数据库自动删除其关联的作业记录（通过外键级联实现）。

------

### **接口设计说明**

1. **RESTful 风格**
   - 整合接口路径为 `/students/assignments`，通过单一请求处理学生和作业的创建。
   - 使用 HTTP POST 方法提交复合数据。
2. **数据校验与处理**
   - **学号唯一性**：通过数据库唯一约束实现。
   - **必填项校验**：前端和后端双重校验。
   - **作业次序格式**：使用正则表达式提取数字（如“第1次作业”提取为 `1`）。
3. **AI集成逻辑**
   - 图片上传后同步调用AI服务生成评分和评语，确保数据一致性。
4. **事务管理**
   - 若学生创建或作业添加失败，数据库事务回滚，避免脏数据。